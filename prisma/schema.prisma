generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum Status {
  ACTIVE
  INACTIVE
}

enum LegPosition {
  LEFT
  RIGHT
}

enum KycStatus {
  PENDING
  APPROVED
  REJECT
}

enum AdminType {
  SUPERADMIN
  ADMIN
  MANAGER
}

//////////////////////////////////////////////////////
// ADMIN MODEL
//////////////////////////////////////////////////////

model Admin {
  id           Int       @id @default(autoincrement()) @map("admin_id")
  firstName    String?   @map("admin_fname")
  email String? @unique
  lastName     String?   @map("admin_lname")
  username     String    @unique @map("admin_username")
  password     String    @map("admin_password")
  adminType    AdminType @map("admin_type")
  accessToken  String?   @map("access_token")
  refreshToken String?   @map("refresh_token")
  status       String    @default("1")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

 // users          User[]
 // userActivities UserActivityLog[]
  loginHistory   AdminLoginHistory[]

  @@map("aa_0_admin_db")
}

//////////////////////////////////////////////////////
// USER MODEL (MLM STRUCTURE)
//////////////////////////////////////////////////////
model User {

  id            Int         @id @default(autoincrement())

  firstName     String

  lastName      String

  mobile        String      @unique

  email         String      @unique

  password      String
 
  sponsorId     Int?

  parentId      Int?

  member_Id     String?

  legPosition   LegPosition?
 
  leftChildId   Int?

  rightChildId  Int?

  lastLeftId    Int?

  lastRightId   Int?
 
  lineagePath   String

  directCount   Int         @default(0)
 
  kycStatus     KycStatus   @default(PENDING)

  status        Status      @default(ACTIVE)
 
  createdAt     DateTime    @default(now())

  updatedAt     DateTime    @updatedAt

  createdBy     String?

  updatedBy     String?
 
  refresh_token String?

  sponsor        User? @relation("SponsorRelation", fields: [sponsorId], references: [id])

  sponsoredUsers User[] @relation("SponsorRelation")
 


  parent   User?  @relation("ParentRelation", fields: [parentId], references: [id])

  children User[] @relation("ParentRelation")
 
  

  leftChild    User?  @relation("LeftChildRelation", fields: [leftChildId], references: [id])

  leftChildren User[] @relation("LeftChildRelation")
 
  

  rightChild    User?  @relation("RightChildRelation", fields: [rightChildId], references: [id])

  rightChildren User[] @relation("RightChildRelation")
 


  lastLeft      User?  @relation("LastLeftRelation", fields: [lastLeftId], references: [id])

  lastLeftUsers User[] @relation("LastLeftRelation")
 
  

  lastRight      User?  @relation("LastRightRelation", fields: [lastRightId], references: [id])

  lastRightUsers User[] @relation("LastRightRelation")
 


  userActivities UserActivityLog[]
 
  kyc Kyc?
 
  @@index([lineagePath])

  @@map("users")

}
 

//////////////////////////////////////////////////////
// KYC MODEL
//////////////////////////////////////////////////////

model Kyc {
  id       Int       @id @default(autoincrement())
  userId   Int       @unique
  aadharNo String
  panNo    String
  status   KycStatus @default(PENDING)

  user User @relation(fields: [userId], references: [id])
 createdAt DateTime @default(now())

  @@map("kyc")
}

//////////////////////////////////////////////////////
// USER ACTIVITY LOG
//////////////////////////////////////////////////////

model UserActivityLog {
  id        Int      @id @default(autoincrement())
  userId    Int?
  adminId   Int
  action    String
  details   String?
  createdAt DateTime @default(now())

  user  User? @relation(fields: [userId], references: [id])
 // admin Admin @relation(fields: [adminId], references: [id])

  @@map("user_activity_logs")
}

//////////////////////////////////////////////////////
// ADMIN LOGIN HISTORY
//////////////////////////////////////////////////////

model AdminLoginHistory {
  id         Int      @id @default(autoincrement())
  adminId    Int
  ipAddress  String?
  loginTime  DateTime @default(now())
  logoutTime DateTime?   // ADD THIS

  admin Admin @relation(fields: [adminId], references: [id])

  @@map("admin_login_history")
}

//////////////////////////////////////////////////////
// PACKAGES MODEL
//////////////////////////////////////////////////////

model Packages {
  id                 String   @id @default(uuid())
  packageName        String
  price              Float
  BV                 Float
  dailyCap           Float
  coinsPerMonth      Float
  packageDescription String
  status             Status   @default(ACTIVE)
  createdAt          DateTime @default(now())
}
